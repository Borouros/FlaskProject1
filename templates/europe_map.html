<!DOCTYPE html>
<html lang="en">
<head>
  <title>Europe Map</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body { margin: 0; padding: 0; }
    #map { height: 100vh; width: 100%; }
    .country-label { font-weight: bold; color: #000; font-size: 12px; text-shadow: 1px 1px 2px white; pointer-events: none; }
    .leaflet-popup-content input { width: 120px; margin-right: 5px; }
  </style>
</head>
<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
let map = L.map('map', {
    center: [54, 15],
    zoom: 4,
    minZoom: 3,
    maxZoom: 7,
    maxBounds: [[34, -25], [72, 45]],
    maxBoundsViscosity: 1.0
});

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

let geoLayer;

function getStoredNames() {
    return JSON.parse(localStorage.getItem('renamedCountries') || '{}');
}
function saveStoredNames(names) {
    localStorage.setItem('renamedCountries', JSON.stringify(names));
}

function getRandomColor() {
    const letters = '0123456789ABCDEF';
    let color = '#';
    for (let i = 0; i < 6; i++) color += letters[Math.floor(Math.random() * 16)];
    return color;
}

fetch('https://raw.githubusercontent.com/leakyMirror/map-of-europe/master/GeoJSON/europe.geojson')
.then(res => res.json())
.then(data => {
    const storedNames = getStoredNames();

    data.features.forEach(f => {
        f.properties.fillColor = getRandomColor();
    });

    geoLayer = L.geoJSON(data, {
        style: feature => ({
            color: "#333",
            weight: 1,
            fillColor: feature.properties.fillColor,
            fillOpacity: 0.7
        }),
        onEachFeature: (feature, layer) => {
            const country = feature.properties.name;
            const displayName = storedNames[country] || country;

            layer.bindTooltip(displayName, { permanent: true, direction: "center", className: "country-label" }).openTooltip();

            layer.bindPopup(() => {
                const container = document.createElement('div');
                container.innerHTML = `<b>${displayName}</b><br>
                    <input type="text" placeholder="Rename..." id="input-${country}">
                    <button>Save</button>`;
                container.querySelector('button').addEventListener('click', () => {
                    const newName = container.querySelector('input').value.trim();
                    if (!newName) return;
                    storedNames[country] = newName;
                    saveStoredNames(storedNames);

                    layer.unbindTooltip();
                    layer.bindTooltip(newName, { permanent: true, direction: "center", className: "country-label" }).openTooltip();
                    layer.closePopup();
                });
                return container;
            });
        }
    }).addTo(map);
});
</script>
</body>
</html>
