<!DOCTYPE html>
<html lang="en">
<head>
  <title>Europe Map</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body { margin:0; padding:0; }
    #map { height: 100vh; width: 100vw; }
    .country-label {
      font-weight: bold;
      color: #8B0016;
      font-size: 12px;
      text-shadow: 1px 1px 2px white;
      text-align: center;
      white-space: nowrap;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
  let map = L.map('map').setView([54, 15], 4);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

  // storage helpers
  function getStoredNames() {
    return JSON.parse(localStorage.getItem('renamedCountries') || '{}');
  }
  function saveStoredNames(names) {
    localStorage.setItem('renamedCountries', JSON.stringify(names));
  }

  // capitals for placement (add more if needed)
  const capitals = {
    "Portugal": [38.7169, -9.139], "Spain": [40.4168, -3.7038], "France": [48.8566, 2.3522],
    "Germany": [52.52, 13.405], "Italy": [41.9028, 12.4964], "United Kingdom": [51.5074, -0.1278],
    "Scotland": [55.9533, -3.1883], "Wales": [51.4816, -3.1791], "Northern Ireland": [54.5973, -5.9301],
    "Ireland": [53.3331, -6.2489], "Norway": [59.9139, 10.7522], "Sweden": [59.3293, 18.0686],
    "Finland": [60.1699, 24.9384], "Denmark": [55.6761, 12.5683], "Netherlands": [52.3676, 4.9041],
    "Belgium": [50.8503, 4.3517], "Luxembourg": [49.6117, 6.1319], "Switzerland": [46.9481, 7.4474],
    "Austria": [48.2082, 16.3738], "Poland": [52.2297, 21.0122], "Czech Republic": [50.0755, 14.4378],
    "Slovakia": [48.1486, 17.1077], "Hungary": [47.4979, 19.0402], "Slovenia": [46.0569, 14.5058],
    "Croatia": [45.815, 15.9785], "Bosnia and Herzegovina": [43.8563, 18.4131], "Serbia": [44.8176, 20.4569],
    "Montenegro": [42.441, 19.2627], "Kosovo": [42.6629, 21.1655], "Albania": [41.3275, 19.8189],
    "North Macedonia": [41.9981, 21.4254], "Greece": [37.9838, 23.7275], "Bulgaria": [42.6977, 23.3219],
    "Romania": [44.4268, 26.1025], "Moldova": [47.0105, 28.8638], "Ukraine": [50.4501, 30.5234],
    "Belarus": [53.9, 27.5667], "Lithuania": [54.6872, 25.2797], "Latvia": [56.9496, 24.1052],
    "Estonia": [59.437, 24.7536], "Turkey": [39.9334, 32.8597]
  };

  // for avoiding label overlap
  let placedLabels = [];

  function addCountryLabel(name, displayName, coords) {
    let adjustedCoords = [...coords];
    placedLabels.forEach(existing => {
      const distance = map.distance(existing, adjustedCoords);
      if (distance < 40) { // too close, shift randomly
        adjustedCoords = [
          adjustedCoords[0] + (Math.random() * 0.3 - 0.15),
          adjustedCoords[1] + (Math.random() * 0.3 - 0.15)
        ];
      }
    });
    placedLabels.push(adjustedCoords);

    L.marker(adjustedCoords, {
      icon: L.divIcon({
        className: "country-label",
        html: displayName,
        iconSize: [80, 20],
        iconAnchor: [40, 10]
      })
    }).addTo(map);
  }

  // Load map data
  fetch('https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json')
    .then(res => res.json())
    .then(data => {
      const storedNames = getStoredNames();

      // Filter Europe
      const europeanData = data.features.filter(f =>
        f.properties.continent === 'Europe' ||
        ["Turkey"].includes(f.properties.name) // force include Turkey
      );

      L.geoJSON(europeanData, {
        style: feature => ({
          color: "#000",
          weight: 1,
          fillColor: '#' + Math.floor(Math.random()*16777215).toString(16),
          fillOpacity: 0.6
        }),
        onEachFeature: (feature, layer) => {
          const country = feature.properties.name;
          const displayName = storedNames[country] || country;

          // rename popup
          layer.bindPopup(
            `<b>${displayName}</b><br>
            <input type="text" id="newName-${country}" placeholder="Rename...">
            <button onclick="rename('${country}')">Save</button>`
          );

          // label at capital
          const coords = capitals[country] || layer.getBounds().getCenter();
          addCountryLabel(country, displayName, coords);

          layer.countryName = country;
        }
      }).addTo(map);
    });

  // renaming function
  function rename(oldName) {
    const input = document.getElementById(`newName-${oldName}`);
    if (!input) return;
    const newName = input.value.trim();
    if (!newName) return;

    const names = getStoredNames();
    names[oldName] = newName;
    saveStoredNames(names);
    location.reload(); // quick refresh to update labels
  }
  </script>
</body>
</html>
